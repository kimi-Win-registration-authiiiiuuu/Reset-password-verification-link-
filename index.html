<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reset Your Password | Kimi-Win</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #6C63FF;
      --primary-dark: #564FC9;
      --success: #4CC9F0;
      --error: #FF3860;
      --warning: #FFA726;
      --text: #2B2D42;
      --text-light: #6C757D;
      --light: #F8F9FA;
      --gray: #ADB5BD;
      --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --card-bg: rgba(255, 255, 255, 0.95);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(
  180deg,
  #000000 0%,
  #006844 10%,
  #007a58 20%,
  #008c6d 30%,
  #009d82 40%,
  #00ad97 50%,
  #00bdac 60%,
  #00cbc1 70%,
  #00d9d6 80%,
  #00e6eb 100%
);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      color: var(--text);
    }
    
    .container {
      background: linear-gradient(
  180deg,
  #005530 0%,
  #006844 10%,
  #007a58 20%,
  #008c6d 30%,
  #009d82 40%,
  #00ad97 50%,
  #00bdac 60%,
  #00cbc1 70%,
  #00d9d6 80%,
  #00e6eb 90%,
  #00e6eb 100%
);
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      max-width: 480px;
      width: 100%;
      position: relative;
      overflow: hidden;
      animation: fadeIn 0.5s ease-out;
      backdrop-filter: blur(500px);
      border: 5px solid rgba(255, 255, 255, 0.9);
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      z-index: -1;
      animation: rotate 20s linear infinite;
    }
    
    .logo {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .logo img {
      height: 200px;
      margin-bottom: 10px;
      fill: var(--primary);
    }
    
    .logo h1 {
      font-size: 28px;
      font-weight: 600;
      background: linear-gradient(to right, var(--primary), #764ba2);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: 1px;
    }
    
    h2 {
      text-align: center;
      margin-bottom: 30px;
      font-weight: 900;
      color: var(--text);
      font-size: 22px;
    }
    
    .input-group {
      position: relative;
      margin-bottom: 25px;
    }
    
    .input-group i {
      position: absolute;
      top: 18px;
      left: 15px;
      color: var(--gray);
      transition: all 0.3s;
    }
    
    input {
      width: 100%;
      padding: 15px 15px 15px 45px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 15px;
      transition: all 0.3s;
      background-color: rgba(255, 255, 255, 0.8);
    }
    
    input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
    }
    
    input:focus + i {
      color: var(--primary);
    }
    
    button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(to right, var(--primary), var(--primary-dark));
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
      position: relative;
      overflow: hidden;
    }
    
    button::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: 0.5s;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(108, 99, 255, 0.3);
    }
    
    button:hover::after {
      left: 100%;
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .message {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      font-size: 14px;
      text-align: center;
      animation: slideUp 0.3s ease-out;
    }
    
    .success {
      background-color: rgba(76, 201, 240, 0.1);
      color: var(--success);
      border: 1px solid rgba(76, 201, 240, 0.3);
    }
    
    .error {
      background-color: rgba(255, 56, 96, 0.1);
      color: var(--error);
      border: 1px solid rgba(255, 56, 96, 0.3);
    }
    
    .password-strength {
      height: 4px;
      background: #e9ecef;
      border-radius: 2px;
      margin-top: -15px;
      margin-bottom: 15px;
      overflow: hidden;
    }
    
    .strength-bar {
      height: 100%;
      width: 0;
      transition: width 0.3s, background 0.3s;
    }
    
    .footer {
      text-align: center;
      margin-top: 30px;
      font-size: 13px;
      color: var(--text-light);
    }
    
    .footer a {
      color: var(--primary);
      text-decoration: none;
      transition: all 0.3s;
    }
    
    .footer a:hover {
      text-decoration: underline;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-content {
      background: linear-gradient(
  180deg,
  #005530 0%,
  #006844 10%,
  #007a58 20%,
  #008c6d 30%,
  #009d82 40%,
  #00ad97 50%,
  #00bdac 60%,
  #00cbc1 70%,
  #00d9d6 80%,
  #00e6eb 90%,
  #00e6eb 100%
);
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
      max-width: 500px;
      width: 90%;
      text-align: center;
      position: relative;
      border: 5px solid rgba(255, 255, 255, 0.9);
    }
    
    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 24px;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .modal-close:hover {
      color: var(--primary);
    }
    
    .modal-icon {
      font-size: 60px;
      color: #4CC9F0;
      margin-bottom: 20px;
      animation: bounce 1s;
    }
    
    .modal-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 15px;
      color: white;
    }
    
    .modal-message {
      font-size: 16px;
      margin-bottom: 25px;
      color: white;
      line-height: 1.6;
    }
    
    .modal-button {
      background: linear-gradient(to right, var(--primary), var(--primary-dark));
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 15px;
    }
    
    .modal-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(108, 99, 255, 0.3);
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
      40% {transform: translateY(-30px);}
      60% {transform: translateY(-15px);}
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    @media (max-width: 480px) {
      .container {
        padding: 30px 20px;
      }
      
      .logo h1 {
        font-size: 24px;
      }
      
      h2 {
        font-size: 20px;
      }
      
      .modal-content {
        padding: 30px 20px;
      }
      
      .modal-title {
        font-size: 20px;
      }
      
      .modal-message {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="logo">
    <!-- My app actual logo -->
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhAt1xxclzKOCTLtLk65hg89EuoC7tJe7WfTYoj0rPwvngjockziQoMR7Ojsp3O6BkdlYZB1yiQOdDZgosVgxqUj3RGR9yT_gIOv19p6f3QEGv6F00rANIZeMd9qV1A5Ftc6SHt8W0TJi94qSmLGp7-pCnwzpoa3PBonADkhHs3vd8IOEMRpdg_ikLUWlE/s16000/1000094921.png"/>
  </div>
  
  <h2>Set Your New Password</h2>
  
  <div class="input-group">
    <i class="fas fa-lock"></i>
    <input type="password" id="password" placeholder="Enter new password" autocomplete="new-password" />
  </div>
  <div class="password-strength">
    <div class="strength-bar" id="strengthBar"></div>
  </div>
  
  <div class="input-group">
    <i class="fas fa-lock"></i>
    <input type="password" id="confirmPassword" placeholder="Confirm new password" autocomplete="new-password" />
  </div>
  
  <button id="submitBtn" onclick="handlePasswordSetup()">
    <span id="btnText">Set Password</span>
    <i class="fas fa-spinner fa-spin" id="spinner" style="display: none;"></i>
  </button>
  
  <div class="message" id="message" style="display: none;"></div>
  
  <div class="footer">
    Â© 2023 Kimi-Win. All rights reserved. <a href="https://kimi-win-registration-authiiiiuuu.github.io/Terms-conditions/">Privacy Policy</a>
  </div>
</div>

<!-- Success Modal -->
<div id="successModal" class="modal">
  <div class="modal-content">
    <span class="modal-close" onclick="closeModal()">&times;</span>
    <div class="modal-icon">
      <i class="fas fa-check-circle"></i>
    </div>
    <h2 class="modal-title">Password Set Successfully!</h2>
    <p class="modal-message">Your new password has been set successfully. You can now open the app and login to your account with your new password.</p>
    <button class="modal-button" onclick="closeModal()">Got It</button>
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js"></script>

<script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyD0Ne46PQqmvUnsq89GUJlKfLpWvsHmtbk",
    authDomain: "kimi-win-90b82.firebaseapp.com",
    databaseURL: "https://kimi-win-90b82-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "kimi-win-90b82",
    storageBucket: "kimi-win-90b82.firebasestorage.app",
    messagingSenderId: "889222798634",
    appId: "1:889222798634:web:86770b996003152f19d253"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // Password strength indicator
  document.getElementById('password').addEventListener('input', function(e) {
    const password = e.target.value;
    const strengthBar = document.getElementById('strengthBar');
    let strength = 0;
    
    if (password.length > 0) strength += 1;
    if (password.length >= 8) strength += 1;
    if (/[A-Z]/.test(password)) strength += 1;
    if (/[0-9]/.test(password)) strength += 1;
    if (/[^A-Za-z0-9]/.test(password)) strength += 1;
    
    const width = strength * 20;
    let color = '#FF3860'; // Red
    
    if (strength <= 1) color = '#FF3860'; // Red
    else if (strength <= 3) color = '#FFA726'; // Orange
    else color = '#4CC9F0'; // Blue/Green
    
    strengthBar.style.width = width + '%';
    strengthBar.style.background = color;
  });

  function showModal() {
    const modal = document.getElementById('successModal');
    modal.style.display = 'flex';
  }

  function closeModal() {
    const modal = document.getElementById('successModal');
    modal.style.display = 'none';
  }

  async function handlePasswordSetup() {
    const messageEl = document.getElementById("message");
    const password = document.getElementById("password").value;
    const confirmPassword = document.getElementById("confirmPassword").value;
    const submitBtn = document.getElementById("submitBtn");
    const btnText = document.getElementById("btnText");
    const spinner = document.getElementById("spinner");

    // Show loading state
    btnText.textContent = "Processing...";
    spinner.style.display = "inline-block";
    submitBtn.disabled = true;

    // Reset message
    messageEl.style.display = "none";

    // Validate password
    if (password.length < 8) {
      showMessage("Password must be at least 8 characters long", "error");
      resetButton();
      return;
    }

    if (password !== confirmPassword) {
      showMessage("Passwords do not match!", "error");
      resetButton();
      return;
    }

    try {
      const url = window.location.href;
      
      if (!auth.isSignInWithEmailLink(url)) {
        showMessage("Invalid or expired verification link.", "error");
        resetButton();
        return;
      }

      let email = window.localStorage.getItem('emailForSignIn');
      if (!email) {
        email = window.prompt('Please provide your email for confirmation:');
        if (!email) {
          showMessage("Email is required to proceed.", "error");
          resetButton();
          return;
        }
      }

      const result = await auth.signInWithEmailLink(email, url);
      const user = result.user;

      await user.updatePassword(password);
      
      // Clear the email from storage
      window.localStorage.removeItem('emailForSignIn');
      
      // Show success modal instead of redirecting
      showModal();
      
    } catch (error) {
      console.error("Password reset error:", error);
      let errorMessage = "An error occurred while setting your password.";
      
      if (error.code === 'auth/weak-password') {
        errorMessage = "Password is too weak. Please choose a stronger password.";
      } else if (error.code === 'auth/expired-action-code') {
        errorMessage = "The password reset link has expired. Please request a new one.";
      } else if (error.code === 'auth/invalid-action-code') {
        errorMessage = "The password reset link is invalid. Please request a new one.";
      } else if (error.code === 'auth/user-disabled') {
        errorMessage = "This account has been disabled. Please contact support.";
      } else if (error.code === 'auth/user-not-found') {
        errorMessage = "No user found with this email address.";
      }
      
      showMessage(errorMessage, "error");
    } finally {
      resetButton();
    }
  }

  function showMessage(message, type) {
    const messageEl = document.getElementById("message");
    messageEl.textContent = message;
    messageEl.className = `message ${type}`;
    messageEl.style.display = "block";
  }

  function resetButton() {
    const submitBtn = document.getElementById("submitBtn");
    const btnText = document.getElementById("btnText");
    const spinner = document.getElementById("spinner");
    
    btnText.textContent = "Set Password";
    spinner.style.display = "none";
    submitBtn.disabled = false;
  }
</script>
</body>
</html>